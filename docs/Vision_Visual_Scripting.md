# 비전: 노드 기반 비주얼 스크립팅 시스템 "시퀀스"

이 문서는 AI-GF 프로젝트가 나아갈 차세대 상호작용 제작 시스템의 비전과 핵심 아키텍처를 기술합니다. 모든 관련 개발은 이 비전에 부합해야 합니다.

## 1. 비전: 사용자를 '관객'에서 '연출가'로

우리의 최종 목표는 사용자를 단순히 캐릭터를 감상하는 '관객'에서, 캐릭터의 모든 행동과 상호작용을 직접 설계하고 연출하는 **'창조자(Creator)'**로 만드는 것입니다.

이를 위해, 코딩 지식이 없는 사용자도 직관적으로 복잡한 로직을 만들 수 있는 **노드 기반의 비주얼 스크립팅 시스템, "시퀀스(Sequence)"**를 도입합니다. 사용자는 이 시스템을 통해 자신만의 캐릭터 성격, 일과, 대화 시나리오를 창조하고, 이를 다른 사용자와 쉽게 공유하며 하나의 거대한 창작 생태계를 형성하게 될 것입니다.

## 2. 핵심 개념

### 가. 시퀀스 (Sequence)
'시퀀스'는 하나의 완전한 상호작용 로직을 담고 있는 노드 그래프이며, 사용자가 만들고 공유하는 콘텐츠의 기본 단위입니다. (예: '아침 인사 시퀀스', '사용자 칭찬에 반응하는 시퀀스')

### 나. 노드 (Node)
노드는 시퀀스를 구성하는 가장 작은 기능 단위입니다. 주요 노드 타입은 다음과 같습니다.

-   **이벤트 노드 (Event Node)**: 시퀀스의 시작점입니다. "사용자가 채팅을 쳤을 때"(`OnChatMessage`)와 같이 특정 사건의 발생을 감지하여 연결된 다음 노드를 실행시킵니다.
-   **액션 노드 (Action Node)**: 실제 동작을 수행하는 노드입니다. "애니메이션 재생", "TTS 말하기" 등 `Actions API`에 등록된 모든 행동이 액션 노드가 될 수 있습니다.
-   **제어 흐름 노드 (Control Flow Node)**: 로직의 흐름을 제어합니다. "만약 ~라면"(Branch), "지연"(Delay) 등이 포함됩니다.
-   **데이터 노드 (Data Node)**: 데이터를 생성하거나, 가져오거나, 가공합니다.
    -   **`LiteralNode`**: 숫자, 문자열, 불리언과 같은 고정된 값을 제공합니다.
    -   **`OperatorNode`**: 두 개의 값을 받아 수학(`+`, `-`), 비교(`==`, `>`), 논리(`AND`, `OR`) 연산을 수행합니다.
    -   **`getContext` (액션 노드)**: `ContextStore`에서 동적인 값을 가져옵니다.

### 다. 데이터 흐름 (Data Flow)
단순히 노드를 순서대로 실행하는 것을 넘어, 한 노드의 결과값(출력)을 다른 노드의 필요값(입력)으로 연결하는 개념입니다. 예를 들어, '사용자 이름 가져오기' 노드의 출력(문자열 "홍길동")을 'TTS 말하기' 노드의 입력(말할 내용)으로 연결하여 "안녕하세요, 홍길동님!"이라고 말하게 만들 수 있습니다. 이것이 시퀀스 시스템의 핵심적인 강력함입니다.

## 3. 주요 아키텍처 현황

### 가. `BaseNode` 클래스 상속 모델
모든 노드는 공통의 `BaseNode` 추상 클래스를 상속받아 각자의 `execute()` 로직을 구현합니다. 이 구조는 '시퀀스 엔진'이 모든 노드를 동일한 방식으로 처리할 수 있게 하여 코드 재사용성과 확장성을 극대화합니다.

### 나. `SequenceEngine` 실행 엔진
노드 그래프의 실행 흐름(Execution Flow)과 데이터 흐름(Data Flow)을 모두 처리하는 핵심 엔진입니다.
-   **실행 흐름**: `exec-in`, `exec-out` 포트를 따라 노드의 `execute()` 메소드를 순차적으로 호출합니다.
-   **데이터 흐름**: `ExecutionContext`를 통해 각 노드의 출력값을 관리하고, 이를 다음 노드의 입력값으로 전달합니다.

### 다. `SequenceManager` 중앙 관리자
시퀀스의 로딩, 저장, 활성화/비활성화 등 모든 생명주기를 관리하는 중앙 관리자입니다. UI 컴포넌트(`App.tsx`)의 복잡도를 낮추고, 상태 관리의 안정성을 높입니다.

### 라. `ActionRegistry` 액션 중앙 저장소
모든 액션의 정의(메타데이터)와 구현(실제 함수)을 한 곳에서 등록하고 관리합니다. `action-registrar.ts`에 액션을 등록하기만 하면, 시퀀스 에디터의 액션 노드 목록과 `PluginContext`의 `actions` API가 자동으로 생성되어 시스템 전체의 일관성과 생산성을 보장합니다.

## 4. 핵심 기능 구현 현황

-   **데이터 흐름 (Data Flow)**: **구현 완료.** 노드 간에 `string`, `number`, `boolean` 등 모든 타입의 데이터를 전달할 수 있습니다.
-   **제어 흐름 (Control Flow)**: **구현 완료.** `Branch (If)`, `Delay` 노드를 통해 조건 분기 및 실행 지연이 가능합니다.
-   **데이터 연산 (Data Operation)**: **구현 완료.** `OperatorNode`를 통해 기본적인 수학, 비교, 논리 연산이 가능합니다.
-   **이벤트 기반 실행**: **구현 완료.** `event-definitions.ts`에 정의된 모든 시스템 이벤트를 기반으로 시퀀스를 시작할 수 있습니다.
-   **저장 및 불러오기**: **구현 완료.** 사용자가 만든 시퀀스를 JSON 파일로 저장하고 다시 불러올 수 있습니다.
-   **사용자 경험(UX) 개선**: 노드 다중 선택, 삭제, 복사/붙여넣기 등 에디터의 사용 편의성 개선이 필요합니다.
