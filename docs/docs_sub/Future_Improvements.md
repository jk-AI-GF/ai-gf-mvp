# 향후 개선사항 제안

이 문서는 AI-GF MVP 프로젝트의 아키텍처를 더욱 견고하고 확장 가능하게 만들기 위한 잠재적인 개선 아이디어를 기록합니다.

## 1. IPC 통신의 타입 안전성 확보

### 현재 구조의 문제점

-   현재 메인 프로세스(`mod-loader.ts`)와 렌더러 프로세스(`VRMCanvas.tsx`) 간의 IPC(Inter-Process Communication) 통신은 **문자열 채널 이름**에 의존하고 있습니다. (예: `'set-expression-weight'`)
-   이 방식은 채널 이름에 오타가 발생하거나, 주고받는 데이터의 타입이 변경되었을 때 컴파일 시점에 에러를 잡을 수 없습니다.
-   버그는 런타임에만 발견되며, 통신이 아무런 경고 없이 조용히 실패하여 디버깅을 매우 어렵게 만듭니다.

### 개선 방향

-   **타입이 정의된 IPC 계약(Contract) 생성:**
    1.  프로젝트의 공유 영역(예: `src/ipc-contract.ts`)에 모든 IPC 채널의 이름과 각 채널이 사용하는 데이터의 타입을 정의하는 인터페이스나 타입을 만듭니다.
    2.  예시:
        ```typescript
        export interface IpcChannels {
          'set-expression-weight': (expressionName: string, weight: number) => void;
          'play-animation': (animationName: string, loop?: boolean) => void;
          // ... other channels
        }
        ```
    3.  메인 프로세스와 렌더러 프로세스 양쪽에서 이 계약 파일을 임포트하여 사용합니다.
-   **타입 안전한 래퍼(Wrapper) 구현:**
    -   `ipcMain`과 `ipcRenderer`를 감싸는 타입 안전한 래퍼 함수를 만들어, 정의된 계약을 기반으로 `send`와 `on` 메서드를 제공합니다.
    -   이를 통해 잘못된 채널 이름을 사용하거나, 데이터 타입이 일치하지 않으면 컴파일 시점에 즉시 오류를 발견할 수 있습니다.

### 기대 효과

-   **개발자 실수 방지:** 오타나 잘못된 데이터 타입으로 인한 버그를 원천적으로 차단합니다.
-   **유지보수성 향상:** IPC 통신과 관련된 코드를 변경할 때, 수정이 필요한 모든 부분을 타입스크립트 컴파일러가 알려주므로 안정성이 크게 향상됩니다.
-   **코드 자동완성:** 개발 도구에서 채널 이름과 필요한 인수를 자동으로 완성해주어 개발 효율이 높아집니다.

## 2. PluginContext의 비대칭성 개선

### 현재 구조의 문제점

-   `PluginContext`는 메인 프로세스와 렌더러 프로세스에서 별도로 생성되며, 렌더러에만 존재하는 `vrmManager` 같은 속성은 인터페이스에서 선택적(`?`)으로 처리됩니다.
-   이는 아키텍처의 현실을 반영한 올바른 해결책이지만, 플러그인 개발자가 `context.vrmManager`에 접근할 때마다 `if (context.vrmManager)`와 같은 방어 코드를 작성해야 하는 불편함이 있습니다.

### 개선 방향 (장기적 관점)

-   **플러그인 타입 분리:**
    -   플러그인의 종류를 명시적으로 구분하는 시스템을 도입할 수 있습니다.
    -   예를 들어, `mod.json`에 `executionContext: 'renderer' | 'main' | 'both'` 와 같은 필드를 추가합니다.
    -   `'renderer'` 컨텍스트에서 실행되는 플러그인에게는 `vrmManager`가 항상 포함된 `RendererPluginContext` 타입을 제공하고, `'main'` 컨텍스트에서 실행되는 플러그인에게는 `MainPluginContext` 타입을 제공하여 타입 안전성을 높일 수 있습니다.

### 기대 효과

-   **타입 명확성:** 플러그인 개발자는 자신이 사용하는 컨텍스트에 어떤 속성이 보장되는지 명확히 알 수 있어 불필요한 방어 코드를 줄일 수 있습니다.
-   **설계 개선:** 플러그인의 실행 환경을 명시적으로 정의함으로써, 시스템 아키텍처가 더욱 정교해지고 예측 가능해집니다.

현재 MVP 단계에서는 IPC 타입 안전성 확보가 더 시급하고 투자 대비 효과가 큰 개선사항으로 판단됩니다.
