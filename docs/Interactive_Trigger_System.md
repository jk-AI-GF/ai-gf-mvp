> **[Legacy]** 이 문서는 현재 시스템의 기반이 되는 레거시(Legacy) 트리거 시스템을 설명합니다. 이 시스템은 향후 더 강력하고 유연한 **노드 기반의 "시퀀스" 시스템**으로 완전히 대체될 예정입니다.

# 대화형 트리거 시스템 (Interactive Trigger System)

이 문서는 사용자가 UI를 통해 직접 캐릭터의 행동 규칙을 만들 수 있는 '대화형 트리거 시스템'의 아키텍처와 사용법을 설명합니다.

## 1. 시스템 목표 (Vision)

이 시스템의 최종 목표는 사용자를 수동적인 '관객'에서 능동적인 **'연출가'이자 '작가'**로 만드는 것입니다. 사용자는 코딩 지식 없이도, UI 조작만으로 캐릭터의 성격, 반응, 하루 일과 등을 직접 창조할 수 있습니다. 이를 통해 개발자가 제공하는 기능의 한계를 넘어, **사용자들이 직접 콘텐츠를 만들고 공유하는 살아있는 생태계**를 구축하고자 합니다.

## 2. 핵심 개념 (Core Concepts)

모든 트리거는 **"만약 ~라면 (조건), ~를 한다 (행동)"**는 명확한 구조를 가집니다. 이 트리거들은 실행 가능한 '코드'가 아닌, `electron-store`에 저장되는 '데이터'(JSON 형식)로 관리됩니다.

-   **조건 (Condition)**: 트리거가 언제 실행되어야 하는지를 정의합니다. `EventBus`에서 발생하는 이벤트(예: `chat:newMessage`)나 시스템의 특정 상태(예: `context.time_of_day`)가 조건이 될 수 있습니다.
-   **행동 (Action)**: 조건이 충족되었을 때 실행될 내용입니다. `PluginContext`의 `actions` API에서 제공하는 모든 기능(예: `playAnimation`, `setExpression`)이 행동이 될 수 있습니다.

**예시 JSON 구조:**
```json
{
  "id": "1678886400000",
  "name": "아침 인사",
  "enabled": true,
  "triggerType": "polling",
  "condition": {
    "key": "time_of_day",
    "operator": "==",
    "value": "morning"
  },
  "action": {
    "type": "playTTS",
    "params": ["좋은 아침이에요!"]
  }
}
```

## 3. UI 기반 편집 흐름

사용자는 사이드바의 '크리에이터 패널'을 통해 모든 커스텀 트리거를 관리할 수 있습니다.

### 가. 크리에이터 패널 (`CreatorPanel.tsx`)

-   **역할**: 현재 저장된 모든 커스텀 트리거의 목록을 보여주고 관리하는 대시보드입니다.
-   **주요 기능**:
    -   **목록 보기**: 저장된 모든 트리거의 이름과 활성화 상태를 표시합니다.
    -   **활성화/비활성화**: 토글 스위치를 통해 각 트리거를 켜고 끌 수 있습니다.
    -   **새 트리거 추가**: '새 트리거 추가' 버튼을 누르면 `트리거 에디터 패널`이 열립니다.
    -   **수정**: '수정' 버튼을 누르면 해당 트리거의 내용이 채워진 `트리거 에디터 패널`이 열립니다.
    -   **삭제**: '삭제' 버튼을 눌러 트리거를 영구적으로 제거합니다.

### 나. 트리거 에디터 패널 (`TriggerEditorPanel.tsx`)

-   **역할**: 단일 트리거의 생성 또는 수정을 담당하는 양식(Form)입니다.
-   **주요 기능**:
    -   **트리거 이름**: 트리거를 식별할 수 있는 이름을 지정합니다.
    -   **실행 시점 (WHEN)**: 트리거가 '주기적 상태 확인(Polling)'으로 작동할지, '특정 이벤트 발생(Event)' 시 작동할지 선택합니다.
    -   **조건 (IF)**: `Context`의 어떤 `key`를 어떤 `operator`로 어떤 `value`와 비교할지 설정합니다.
    -   **액션 (THEN)**: 조건 충족 시 실행할 `action`의 종류와 필요한 `params`를 설정합니다.
    -   **저장**: '저장' 버튼을 누르면 `App.tsx`에 변경 사항을 알리고 패널이 닫힙니다.

## 4. 데이터 흐름 및 상태 관리

트리거 관련 상태는 모두 최상위 컴포넌트인 `App.tsx`에서 관리하여 데이터 흐름을 단순하게 유지합니다.

1.  **초기화**: `App.tsx`는 시작 시 `electron-store`에서 모든 커스텀 트리거를 불러와 `customTriggers` 상태에 저장합니다.
2.  **전달**: `customTriggers` 배열은 `CreatorPanel`에 prop으로 전달되어 목록을 렌더링합니다.
3.  **수정/추가 요청**: `CreatorPanel`에서 '수정' 또는 '새로 추가' 버튼이 클릭되면, `App.tsx`는 `TriggerEditorPanel`을 열고, 편집할 트리거 정보(`editingTrigger`)를 state에 설정합니다.
4.  **저장**: `TriggerEditorPanel`에서 '저장'이 클릭되면, 변경된 트리거 객체를 `onSave` 콜백을 통해 `App.tsx`로 전달합니다.
5.  **업데이트**: `App.tsx`는 전달받은 트리거로 `customTriggers` 상태를 업데이트하고, `electron-store`에 저장하며, `PluginManager`를 통해 실제 시스템(활성/비활성)에 변경 사항을 즉시 반영합니다.
6.  **삭제**: `CreatorPanel`에서 '삭제'가 클릭되면, `App.tsx`는 해당 트리거를 `customTriggers` 상태와 `electron-store`에서 제거하고, 시스템에서도 비활성화합니다.

이러한 단방향 데이터 흐름은 상태 관리를 예측 가능하게 하고 유지보수를 용이하게 합니다.
